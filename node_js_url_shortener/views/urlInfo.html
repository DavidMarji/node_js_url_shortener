<!DOCTYPE html>
<html lang="en">
    <body id="body">
        <h1 id="hash"><%= hash %></h1>
        <script>
            const user = sessionStorage.getItem("userSession");
            const hash = document.getElementById("hash").innerText;
            const fetchUrl = `/urls/${hash}/info`;

            fetch(fetchUrl.toString(),{
                method : "GET",
                headers: 
                {
                    'Content-Type': 'application/json',
                    "authentication" : user,
                }
            })
            .then(res => {
                if(res.status === 200){
                    res.json().then(json => {
                        const usernameDiv = document.createElement("div");
                        const clicksDiv = document.createElement("div");
                        const urlDiv = document.createElement("div");

                        const usernameP = document.createElement("p");
                        const clicksP = document.createElement("p");
                        const urlP = document.createElement("a");

                        const usernameText = document.createTextNode(`This shortened url was generated by user: ${json.username}`);
                        const clicksText = document.createTextNode(`This shortened url has ${json.clicks} clicks`);
                        const urlText = document.createTextNode(`This is the url: ${json.url}`);

                        const body = document.getElementById("body");
                        body.appendChild(urlDiv);
                        urlDiv.appendChild(urlP);
                        urlP.appendChild(urlText);
                        urlP.href = `/${hash}`;

                        body.appendChild(usernameDiv);
                        usernameDiv.appendChild(usernameP);
                        usernameP.appendChild(usernameText);

                        body.appendChild(clicksDiv);
                        clicksDiv.appendChild(clicksP);
                        clicksP.appendChild(clicksText);
                    });
                }
                else if(res.status === 401){
                    window.location.href = "/unauthorized";
                }
                else{
                    window.location.href = "/notFound";
                }
            }).catch(e => console.log(e));
        </script>
    </body>
</html>